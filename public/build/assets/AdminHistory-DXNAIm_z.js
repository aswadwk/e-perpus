import{r as o,W as h,y as S,j as e,Y as v}from"./app-F26IiqHC.js";import{D as C}from"./DefaultLayout-j8MVkCbC.js";import{P as D,a as _}from"./PaginateDemo-kUy-j6ea.js";import{S as y}from"./SelectInput-Z3E2IC9m.js";import{S as B}from"./Sheet-B_-txCUc.js";import{B as u}from"./button-tZXLudKu.js";import{C as N,a as P,b as T,e as H,c as E,d as F}from"./card-DosAqAye.js";import{I}from"./input-dYGD7Fwo.js";import{T as R,a as U,b as p,c as r,d as M,e as n}from"./table-ChLu0HbR.js";import{l as A,r as J,t as j,d as O,a as Y}from"./lodash-WQ8CjN4e.js";import{J as f}from"./react-icons.esm-CwI9vBYE.js";import{S as z}from"./square-pen-BiGLXiak.js";import"./separator-DdjQagW8.js";import"./index-lS7YWa7-.js";import"./dialog-hvHEIC8o.js";import"./popover-coa3a2Eb.js";import"./label-DfeQ5_mr.js";function V(s){switch(s){case"pending":return"Menunggu";case"borrowed":return"Dipinjam";case"returned":return"Dikembalikan";case"rejected":return"Ditolak";default:return s}}const ce=({histories:s})=>{var x;const[t,i]=o.useState({per_page:10,start_date:"",end_date:"",search:"",with_trashed:!1}),[d,c]=o.useState({borrowBook:!1}),l=h({status:"",id:"",return_date_actual:""});h({});const m=o.useRef(!0),b=o.useRef(A.debounce(a=>{let w=J({...a,start_date:j(a.start_date,""),end_date:j(a.end_date,"")});S.get(route("web.histories.admin"),{...w},{preserveState:!0,preserveScroll:"errors"})},500)).current;o.useEffect(()=>{if(m.current){m.current=!1;return}b(t)},[t]);function k(){return t.search||t.with_trashed}async function g(){l.post(route("web.histories.update",l.data.id),{preserveState:!0,onSuccess:()=>{l.reset(),f.success("Book status updated successfully"),c({...d,borrowBook:!1})},onError:()=>{f.error("Failed to update book status")}})}return e.jsxs(C,{children:[e.jsx(v,{title:"Publisher"}),e.jsx(B,{isOpen:d.borrowBook,onClose:()=>{c({...d,borrowBook:!1})},width:"w-[600px] sm:w-[840px]",title:"Ubah Status Peminjaman Buku",description:"Ubah status peminjaman buku",children:e.jsx(L,{form:l,onSubmit:g})}),e.jsxs(N,{className:"w-full mx-auto",children:[e.jsxs(P,{children:[e.jsx(T,{children:"Histori Peminjaman Buku"}),e.jsx(H,{children:"Daftar pemijaman buku yang pernah dilakukan oleh pengguna"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[k()&&e.jsx(u,{variant:"outline",onClick:()=>{i({...t,search:"",per_page:"",with_trashed:!1})},children:"Clear Filter"}),e.jsx(I,{placeholder:"Search nama peminjam...",onChange:a=>{i({...t,search:a.target.value})},className:"w-[150px] lg:w-[250px]",value:t.search})]})}),e.jsxs(R,{children:[e.jsx(U,{children:e.jsxs(p,{children:[e.jsx(r,{children:"Peminjam"}),e.jsx(r,{children:"Judul"}),e.jsx(r,{children:"Author"}),e.jsx(r,{children:"Tanggal Pinjam"}),e.jsx(r,{children:"Tanggal Balik"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Aksi"})]})}),e.jsx(M,{children:(x=s.data)==null?void 0:x.map(a=>e.jsxs(p,{children:[e.jsxs(n,{className:"font-medium",children:[a.user.name,e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:a.user.email})]}),e.jsx(n,{className:"font-medium",children:a.book.title}),e.jsx(n,{children:a.book.author}),e.jsxs(n,{children:[O(a.created_at),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:Y(a.created_at)})]}),e.jsx(n,{children:a.return_date}),e.jsx(n,{children:V(a.status)}),e.jsx(n,{children:e.jsx(u,{variant:"ghost",onClick:()=>{l.setData("id",a.id),c({...d,borrowBook:!0})},children:e.jsx(z,{size:16})})})]},a.id))})]})]}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(D,{from:s.from,to:s.to,total:s.total}),e.jsx("div",{children:e.jsx(_,{links:s.links})})]})})]})]})},q=[{value:"pending",label:"Pending"},{value:"borrowed",label:"Dipinjam"},{value:"returned",label:"Dikembalikan"},{value:"rejected",label:"Ditolak"}];function L({onSubmit:s,form:t}){return e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"flex flex-col gap-3 mb-4",children:e.jsx("div",{className:"flex flex-col gap-2 ",children:e.jsx(y,{onChange:i=>t.setData("status",i),label:"Status",placeholder:"Select status...",items:q,currentValue:t.data.status})})}),e.jsx(u,{onClick:()=>{s()},children:"Update"})]})}export{ce as default};
